/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=function(n){return function(e){return e=typeof(t=e),(null===t?"null":"object"==e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e)===n;var t}},n=function(t){return function(e){return typeof e===t}},o=t("string"),u=t("object"),i=t("array"),r=n("boolean"),a=n("function"),s=n("number"),c=function(){},f=function(e){return function(){return e}},d=function(t){return function(e){return!t(e)}},l=f(!1),m=f(!0),p=function(){return g},g=(W=function(e){return e.isNone()},{fold:function(e,t){return e()},is:l,isSome:l,isNone:m,getOr:t=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:f(null),getOrUndefined:f(undefined),or:t,orThunk:n,map:p,each:c,bind:p,exists:l,forall:m,filter:p,equals:W,equals_:W,toArray:function(){return[]},toString:f("none()")}),h=function(n){var e=f(n),t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:m,isNone:l,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return h(e(n))},each:function(e){e(n)},bind:r,exists:r,forall:r,filter:function(e){return e(n)?o:g},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(l,function(e){return t(n,e)})}};return o},v={some:h,none:p,from:function(e){return null===e||e===undefined?g:h(e)}},y=Array.prototype.slice,S=Array.prototype.push,C=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},b=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},O=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},N=function(e,t,n){return b(e,function(e){n=t(n,e)}),n},L=function(e,t,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(t(i,r))return v.some(i);if(n(i,r))break}return v.none()},T=function(e,t){return L(e,t,l)},w=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!i(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);S.apply(t,e[n])}return t}(C(e,t))},D=function(e){e=y.call(e,0);return e.reverse(),e},k=function(e,t){return 0<=t&&t<e.length?v.some(e[t]):v.none()},x=function(e){return k(e,0)},A=function(e){return k(e,e.length-1)},E=function(){return(E=Object.assign||function E(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};var P,B,I,R,M,U=function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}return undefined}(e,t);if(!n)return{major:0,minor:0};e=function(e){return Number(t.replace(n,"$"+e))};return $(e(1),e(2))},_=function(){return $(0,0)},$=function(e,t){return{major:e,minor:t}},F={nu:$,detect:function(e,t){t=String(t).toLowerCase();return 0===e.length?_():U(e,t)},unknown:_},H=function(e,t){var n=String(t).toLowerCase();return T(e,function(e){return e.search(n)})},j=function(e,n){return H(e,n).map(function(e){var t=F.detect(e.versionRegexes,n);return{current:e.name,version:t}})},q=function(e,n){return H(e,n).map(function(e){var t=F.detect(e.versionRegexes,n);return{current:e.name,version:t}})},K=function(e,t){return-1!==e.indexOf(t)},V=(P=/^\s+|\s+$/g,function(e){return e.replace(P,"")}),n=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,W=function(t){return function(e){return K(e,t)}},p=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return K(e,"edge/")&&K(e,"chrome")&&K(e,"safari")&&K(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,n],search:function(e){return K(e,"chrome")&&!K(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return K(e,"msie")||K(e,"trident")}},{name:"Opera",versionRegexes:[n,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:W("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:W("firefox")},{name:"Safari",versionRegexes:[n,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(K(e,"safari")||K(e,"mobile/"))&&K(e,"applewebkit")}}],n=[{name:"Windows",search:W("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return K(e,"iphone")||K(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:W("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:W("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:W("linux"),versionRegexes:[]},{name:"Solaris",search:W("sunos"),versionRegexes:[]},{name:"FreeBSD",search:W("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:W("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Q={browsers:f(p),oses:f(n)},X="Firefox",z=function(e){var t=e.current,n=e.version,e=function(e){return function(){return t===e}};return{current:t,version:n,isEdge:e("Edge"),isChrome:e("Chrome"),isIE:e("IE"),isOpera:e("Opera"),isFirefox:e(X),isSafari:e("Safari")}},Y={unknown:function(){return z({current:undefined,version:F.unknown()})},nu:z,edge:f("Edge"),chrome:f("Chrome"),ie:f("IE"),opera:f("Opera"),firefox:f(X),safari:f("Safari")},Z="Windows",G="Android",J="Solaris",ee="FreeBSD",te="ChromeOS",ne=function(e){var t=e.current,n=e.version,e=function(e){return function(){return t===e}};return{current:t,version:n,isWindows:e(Z),isiOS:e("iOS"),isAndroid:e(G),isOSX:e("OSX"),isLinux:e("Linux"),isSolaris:e(J),isFreeBSD:e(ee),isChromeOS:e(te)}},re={unknown:function(){return ne({current:undefined,version:F.unknown()})},nu:ne,windows:f(Z),ios:f("iOS"),android:f(G),linux:f("Linux"),osx:f("OSX"),solaris:f(J),freebsd:f(ee),chromeos:f(te)},oe=function(e,t){var n,r,o=Q.browsers(),i=Q.oses(),u=j(o,e).fold(Y.unknown,Y.nu),a=q(i,e).fold(re.unknown,re.nu);return{browser:u,os:a,deviceType:(n=u,r=e,o=t,u=(i=a).isiOS()&&!0===/ipad/i.test(r),e=i.isiOS()&&!u,t=i.isiOS()||i.isAndroid(),a=t||o("(pointer:coarse)"),o=u||!e&&t&&o("(min-device-width:768px)"),t=e||t&&!o,r=n.isSafari()&&i.isiOS()&&!1===/safari/i.test(r),{isiPad:f(u),isiPhone:f(e),isTablet:f(o),isPhone:f(t),isTouch:f(a),isAndroid:i.isAndroid,isiOS:i.isiOS,isWebView:f(r),isDesktop:f(!t&&!o&&!r)})}},ie=function(e){return window.matchMedia(e).matches},ue=(R=!(B=function(){return oe(navigator.userAgent,ie)}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return R||(R=!0,I=B.apply(null,e)),I}),ae=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:e}},se={fromHtml:function(e,t){t=(t||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return ae(t.childNodes[0])},fromTag:function(e,t){e=(t||document).createElement(e);return ae(e)},fromText:function(e,t){e=(t||document).createTextNode(e);return ae(e)},fromDom:ae,fromPoint:function(e,t,n){return v.from(e.dom.elementFromPoint(t,n)).map(ae)}},ce=function(e,t){return e.dom===t.dom},fe=function(e,t){return n=e.dom,e=t.dom,t=Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(n.compareDocumentPosition(e)&t);var n},de=function(e,t){return(ue().browser.isIE()?fe:function(e,t){e=e.dom,t=t.dom;return e!==t&&e.contains(t)})(e,t)},le=function(e,t){e=e.dom;if(1!==e.nodeType)return!1;if(e.matches!==undefined)return e.matches(t);if(e.msMatchesSelector!==undefined)return e.msMatchesSelector(t);if(e.webkitMatchesSelector!==undefined)return e.webkitMatchesSelector(t);if(e.mozMatchesSelector!==undefined)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},me=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),pe=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),ge=tinymce.util.Tools.resolve("tinymce.util.VK"),he=Object.keys,ve=function(e,t){for(var n=he(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},ye=function(e,t){var n,r,o,i,u={};return n=t,i=u,r=function(e,t){i[t]=e},o=c,ve(e,function(e,t){(n(e,t)?r:o)(e,t)}),u},Se=("undefined"!=typeof window||Function("return this;")(),function(e){return e.dom.nodeName.toLowerCase()}),Ce=(M=1,function(e){return e.dom.nodeType===M}),be=function(e,t){var n=e.dom;ve(t,function(e,t){!function(e,t,n){if(!(o(n)||r(n)||s(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}(n,t,e)})},Oe=function(e){return N(e.dom.attributes,function(e,t){return e[t.name]=t.value,e},{})},Ne=function(e){return v.from(e.dom.parentNode).map(se.fromDom)},Le=function(e){return C(e.dom.childNodes,se.fromDom)},Te=function(e,t){e=e.dom.childNodes;return v.from(e[t]).map(se.fromDom)},we=function(e){return Te(e,0)},De=function(e){return Te(e,e.dom.childNodes.length-1)},ke=function(t,n){Ne(t).each(function(e){e.dom.insertBefore(n.dom,t.dom)})},xe=function(e,t){e.dom.appendChild(t.dom)},Ae=function(t,e){b(e,function(e){xe(t,e)})},Ee=function(e){e=e.dom;null!==e.parentNode&&e.parentNode.removeChild(e)},Pe=function(e){return t=!0,se.fromDom(e.dom.cloneNode(t));var t},Be=function(e,t){var n=function(e,t){t=se.fromTag(t),e=Oe(e);return be(t,e),t}(e,t);ke(e,n);t=Le(e);return Ae(n,t),Ee(e),n},W=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Ie=tinymce.util.Tools.resolve("tinymce.util.Tools"),p=function(t){return function(e){return e&&e.nodeName.toLowerCase()===t}},n=function(t){return function(e){return e&&t.test(e.nodeName)}},Re=function(e){return e&&3===e.nodeType},Me=n(/^(OL|UL|DL)$/),Ue=n(/^(OL|UL)$/),_e=p("ol"),$e=n(/^(LI|DT|DD)$/),Fe=n(/^(DT|DD)$/),He=n(/^(TH|TD)$/),je=p("br"),qe=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},Ke=function(e,t){return e&&e.nodeName in t},Ve=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},We=function(e,t){return e.isChildOf(t,e.getRoot())},Qe=function(e,t){var n,r,o,i=e.dom,u=e.schema.getBlockElements(),a=i.createFragment(),s=function(e){e=e.getParam("forced_root_block","p");return!1===e?"":!0===e?"p":e}(e);if(s&&((r=i.create(s)).tagName===s.toUpperCase()&&i.setAttribs(r,e.getParam("forced_root_block_attrs",{})),Ke(t.firstChild,u)||a.appendChild(r)),t)for(;n=t.firstChild;){var c=n.nodeName;o||"SPAN"===c&&"bookmark"===n.getAttribute("data-mce-type")||(o=!0),Ke(n,u)?(a.appendChild(n),r=null):s?(r||(r=i.create(s),a.appendChild(r)),r.appendChild(n)):a.appendChild(n)}return s?o||r.appendChild(i.create("br",{"data-mce-bogus":"1"})):a.appendChild(i.create("br")),a},Xe=W.DOM,ze=function(e,t,n){var r=Xe.select('span[data-mce-type="bookmark"]',t),o=Qe(e,n),i=Xe.createRng();i.setStartAfter(n),i.setEndAfter(t);for(var u,i=i.extractContents(),a=i.firstChild;a;a=a.firstChild)if("LI"===a.nodeName&&e.dom.isEmpty(a)){Xe.remove(a);break}e.dom.isEmpty(i)||Xe.insertAfter(i,t),Xe.insertAfter(o,t),Ve(e.dom,n.parentNode)&&(u=n.parentNode,Ie.each(r,function(e){u.parentNode.insertBefore(e,n.parentNode)}),Xe.remove(u)),Xe.remove(n),Ve(e.dom,t)&&Xe.remove(t)},Ye=function(e){le(e,"dt")&&Be(e,"dd")},Ze=function(r,e,t){b(t,"Indent"===e?Ye:function(e){return t=r,le(n=e,"dd")?Be(n,"dt"):le(n,"dt")&&Ne(n).each(function(e){return ze(t,e.dom,n.dom)}),0;var t,n})},Ge=function(e,t){if(Re(e))return{container:e,offset:t};var n=me.getNode(e,t);return Re(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&Re(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&Re(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},Je=function(e){var t=e.cloneRange(),n=Ge(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);e=Ge(e.endContainer,e.endOffset);return t.setEnd(e.container,e.offset),t},et=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),tt=function(e,t){t=t||e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",ot(e,t))},nt=function(e){var t,n=tt(e),r=e.selection.getSelectedBlocks();return t=r,(e=n)&&1===t.length&&t[0]===e?Ie.grep(n.querySelectorAll("ol,ul,dl"),function(e){return Me(e)}):Ie.grep(r,function(e){return Me(e)&&n!==e})},rt=function(e){var t=e.selection.getSelectedBlocks();return Ie.grep(function(n,e){e=Ie.map(e,function(e){var t=n.dom.getParent(e,"li,dd,dt",ot(n,e));return t||e});return et.unique(e)}(e,t),function(e){return $e(e)})},ot=function(e,t){t=e.dom.getParents(t,"TD,TH");return 0<t.length?t[0]:e.getBody()},it=function(e,t){t=e.dom.getParents(t,"ol,ul",ot(e,t));return A(t)},ut=function(e){var t,n,t=(n=it(t=e,t.selection.getStart()),t=O(t.selection.getSelectedBlocks(),Ue),n.toArray().concat(t));return at(e,t)},at=function(t,e){e=C(e,function(e){return it(t,e).getOr(e)});return et.unique(e)},st=function(e,t,n){return e.isSome()&&t.isSome()?v.some(n(e.getOrDie(),t.getOrDie())):v.none()},ct=function(e,t,n){return e.fire("ListMutation",{action:t,element:n})},ft=function(e,t,n){if(!o(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);var r;(r=e).style!==undefined&&a(r.style.getPropertyValue)&&e.style.setProperty(t,n)},dt=function(e,t){xe(e.item,t.list)},lt=function(e,t,n){for(var r=[],o=0;o<n;o++)r.push(function(e,t){e={list:se.fromTag(t,e),item:se.fromTag("li",e)};return xe(e.list,e.item),e}(e,t.listType));return r},mt=function(e,t){for(var n=0;n<e.length-1;n++)!function(e,t,n){e=e.dom;ft(e,t,n)}(e[n].item,"list-style-type","none");A(e).each(function(e){be(e.list,t.listAttributes),be(e.item,t.itemAttributes),Ae(e.item,t.content)})},pt=function(r,e,o){e=e.slice(0,o.depth);return A(e).each(function(e){var t,n=function(e,t,n){e=se.fromTag("li",e);return be(e,t),Ae(e,n),e}(r,o.itemAttributes,o.content);t=n,xe((n=e).list,t),n.item=t,t=o,Se((e=e).list)!==t.listType&&(e.list=Be(e.list,t.listType)),be(e.list,t.listAttributes)}),e},gt=function(e,t,n){e=lt(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)dt(e[t-1],e[t])}(e),mt(e,n),n=e,st(A(t),x(n),dt),t.concat(e)},ht=function(e){return le(e,"OL,UL")},vt=function(e){return we(e).map(ht).getOr(!1)},yt=function(e){return 0<e.depth},St=function(e){return e.isSelected},Ct=function(e){var t=Le(e),t=De(e).map(ht).getOr(!1)?t.slice(0,-1):t;return C(t,Pe)},bt=function(a){return b(a,function(n,e){var t,r,o,i,u;o=(t=a)[r=e].depth,i=function(e){return e.depth===o&&!e.dirty},u=function(e){return e.depth<o},L(D(t.slice(0,r)),i,u).orThunk(function(){return L(t.slice(r+1),i,u)}).fold(function(){n.dirty&&(n.listAttributes=ye(n.listAttributes,function(e,t){return"start"!==t}))},function(e){return t=e,(e=n).listType=t.listType,void(e.listAttributes=E({},t.listAttributes));var t})}),a},Ot=function(i,u,a,s){return we(s).filter(ht).fold(function(){u.each(function(e){ce(e.start,s)&&a.set(!0)});var t,n,r,e=(t=s,n=i,r=a.get(),Ne(t).filter(Ce).map(function(e){return{depth:n,dirty:!1,isSelected:r,content:Ct(t),itemAttributes:Oe(t),listAttributes:Oe(e),listType:Se(e)}}));u.each(function(e){ce(e.end,s)&&a.set(!1)});var o=De(s).filter(ht).map(function(e){return Nt(i,u,a,e)}).getOr([]);return e.toArray().concat(o)},function(e){return Nt(i,u,a,e)})},Nt=function(t,n,r,e){return w(Le(e),function(e){return(ht(e)?Nt:Ot)(t+1,n,r,e)})},Lt=function(r,e){e=bt(e);return C(e,function(e){var t,n,e=(e=e.content,n=(t||document).createDocumentFragment(),b(e,function(e){n.appendChild(e.dom)}),se.fromDom(n));return se.fromDom(Qe(r,e.dom))})},Tt=function(e,t){t=bt(t);return function(n,e){e=N(e,function(e,t){return(t.depth>e.length?gt:pt)(n,e,t)},[]);return x(e).map(function(e){return e.list})}(e.contentDocument,t).toArray()},wt=function(e,t){b(O(e,St),function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0}(t,e),0})},Dt=function(o,e,i){var t,n,r,e=(e=e,t=function(e){e=C(rt(e),se.fromDom);return st(T(e,d(vt)),T(D(e),d(vt)),function(e,t){return{start:e,end:t}})}(o),n=!1,r={get:function(){return n},set:function(e){n=e}},C(e,function(e){return{sourceList:e,entries:Nt(0,t,r,e)}}));b(e,function(e){wt(e.entries,i);var t,n,r,n=(t=o,n=e.entries,w(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=t(a);s!==n&&(r.push(o),o=[]),n=s,o.push(a)}return 0!==o.length&&r.push(o),r}(n,yt),function(e){return(x(e).map(yt).getOr(!1)?Tt:Lt)(t,e)}));b(n,function(e){ct(o,"Indent"===i?"IndentList":"OutdentList",e.dom)}),r=e.sourceList,b(n,function(e){ke(r,e)}),Ee(e.sourceList)})},kt=function(e,t){var n,r=C(ut(e),se.fromDom),o=C(O(rt(e),Fe),se.fromDom),i=!1;return(r.length||o.length)&&(n=e.selection.getBookmark(),Dt(e,r,t),Ze(e,t,o),e.selection.moveToBookmark(n),e.selection.setRng(Je(e.selection.getRng())),e.nodeChanged(),i=!0),i},xt=function(e){return kt(e,"Indent")},At=function(e){return kt(e,"Outdent")},Et=function(e){return kt(e,"Flatten")},Pt=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),Bt=W.DOM,It=function(o){var i={},e=function(e){var t,n=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"];1===n.nodeType&&(t=Bt.create("span",{"data-mce-type":"bookmark"}),n.hasChildNodes()?(r=Math.min(r,n.childNodes.length-1),e?n.insertBefore(t,n.childNodes[r]):Bt.insertAfter(t,n.childNodes[r])):n.appendChild(t),n=t,r=0),i[e?"startContainer":"endContainer"]=n,i[e?"startOffset":"endOffset"]=r};return e(!0),o.collapsed||e(),i},Rt=function(o){var e=function(e){var t,n=t=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"];n&&(1===n.nodeType&&(r=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(n),n=n.parentNode,Bt.remove(t),!n.hasChildNodes()&&Bt.isBlock(n)&&n.appendChild(Bt.create("br"))),o[e?"startContainer":"endContainer"]=n,o[e?"startOffset":"endOffset"]=r)};e(!0),e();e=Bt.createRng();return e.setStart(o.startContainer,o.startOffset),o.endContainer&&e.setEnd(o.endContainer,o.endOffset),Je(e)},Mt=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Ut=function(e){return/\btox\-/.test(e.className)},_t=function(e,t,n){var r=function(e){e=L(e.parents,Me,He).filter(function(e){return e.nodeName===t&&!Ut(e)}).isSome();n(e)},o=e.dom.getParents(e.selection.getNode());return r({parents:o}),e.on("NodeChange",r),function(){return e.off("NodeChange",r)}},$t=function(n,e){Ie.each(e,function(e,t){n.setAttribute(t,e)})},Ft=function(e,t,n){var r;!function(e,t,n){n=n["list-style-type"]||null;e.setStyle(t,"list-style-type",n)}(e,t,n),e=e,$t(t=t,(r=n)["list-attributes"]),Ie.each(e.select("li",t),function(e){$t(e,r["list-item-attributes"])})},Ht=function(e,t,n,r){var o=t[n?"startContainer":"endContainer"],t=t[n?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(t,o.childNodes.length-1)]||o),!n&&je(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(qe(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},jt=function(u,a,s){var e,t=u.selection.getRng(),c="LI",n=ot(u,u.selection.getStart(!0)),f=u.dom;"false"!==f.getContentEditable(u.selection.getNode())&&("DL"===(a=a.toUpperCase())&&(c="DT"),e=It(t),n=function(n,e,r){for(var o,i=[],u=n.dom,t=Ht(n,e,!0,r),a=Ht(n,e,!1,r),s=[],c=t;c&&(s.push(c),c!==a);c=c.nextSibling);return Ie.each(s,function(e){if(qe(n,e))return i.push(e),void(o=null);if(u.isBlock(e)||je(e))return je(e)&&u.remove(e),void(o=null);var t=e.nextSibling;Pt.isBookmarkNode(e)&&(Me(t)||qe(n,t)||!t&&e.parentNode===r)?o=null:(o||(o=u.create("p"),e.parentNode.insertBefore(o,e),i.push(o)),o.appendChild(e))}),i}(u,t,n),Ie.each(n,function(e){var t,n,r,o=e.previousSibling,i=e.parentNode;$e(i)||(o&&Me(o)&&o.nodeName===a&&function(e,t,n){t=e.getStyle(t,"list-style-type"),n=n?n["list-style-type"]:"";return t===(n=null===n?"":n)}(f,o,s)?(t=o,e=f.rename(e,c),o.appendChild(e)):(t=f.create(a),e.parentNode.insertBefore(t,e),t.appendChild(e),e=f.rename(e,c)),n=f,r=e,e=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],Ie.each(e,function(e){var t;return n.setStyle(r,((t={})[e]="",t))}),Ft(f,t,s),Kt(u.dom,t))}),u.selection.setRng(Rt(e)))},qt=function(e,t,n){return o=n,(r=t)&&o&&Me(r)&&r.nodeName===o.nodeName&&(o=n,(e=e).getStyle(t,"list-style-type",!0)===e.getStyle(o,"list-style-type",!0))&&t.className===n.className;var r,o},Kt=function(e,t){var n,r=t.nextSibling;if(qt(e,t,r)){for(;n=r.firstChild;)t.appendChild(n);e.remove(r)}if(r=t.previousSibling,qt(e,t,r)){for(;n=r.lastChild;)t.insertBefore(n,t.firstChild);e.remove(r)}},Vt=function(i,e,t,u,a){var n,r=Me(e);r&&e.nodeName===u&&!Wt(a)?Et(i):(jt(i,u,a),n=It(i.selection.getRng(!0)),t=r?function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)r[o]=i[u];return r}([e],t):t,Ie.each(t,function(e){var t,n,r,o;t=i,r=u,o=a,(n=e).nodeName!==r?(e=t.dom.rename(n,r),Ft(t.dom,e,o),ct(t,Mt(r),e)):(Ft(t.dom,n,o),ct(t,Mt(r),n))}),i.selection.setRng(Rt(n)))},Wt=function(e){return"list-style-type"in e},Qt=function(e,t,n){var r=tt(e),o=nt(e),i=u(n)?n:{};0<o.length?Vt(e,r,o,t,i):(n=t,o=i,(t=r)!==(i=e).getBody()&&(t?t.nodeName!==n||Wt(o)||Ut(t)?(r=It(i.selection.getRng(!0)),Ft(i.dom,t,o),e=i.dom.rename(t,n),Kt(i.dom,e),i.selection.setRng(Rt(r)),jt(i,n,o),ct(i,Mt(n),e)):Et(i):(jt(i,n,o),ct(i,Mt(n),t))))},Xt=W.DOM,zt=function(o,e){Ie.each(Ie.grep(o.select("ol,ul",e)),function(e){var t,n,r;t=o,"LI"===(e=(n=e).parentNode).nodeName&&e.firstChild===n&&((r=e.previousSibling)&&"LI"===r.nodeName?(r.appendChild(n),Ve(t,e)&&Xt.remove(e)):Xt.setStyle(e,"listStyleType","none")),Me(e)&&(r=e.previousSibling)&&"LI"===r.nodeName&&r.appendChild(n)})},Yt=function(e,t,n,r){var o=t.startContainer,t=t.startOffset;if(Re(o)&&(n?t<o.data.length:0<t))return o;var i=e.schema.getNonEmptyElements();1===o.nodeType&&(o=me.getNode(o,t));var u=new pe(o,r);for(n&&(r=e.dom,je(e=o)&&r.isBlock(e.nextSibling)&&!je(e.previousSibling)&&u.next());o=u[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(i[o.nodeName])return o;if(Re(o)&&0<o.data.length)return o}},Zt=function(e,t){t=t.childNodes;return 1===t.length&&!Me(t[0])&&e.isBlock(t[0])},Gt=function(e,t,n){var r,o,i=Zt(e,n)?n.firstChild:n;if(Zt(o=e,n=t)&&o.remove(n.firstChild,!0),!Ve(e,t,!0))for(;r=t.firstChild;)i.appendChild(r)},Jt=function(t,e,n){var r,o=e.parentNode;We(t,e)&&We(t,n)&&(Me(n.lastChild)&&(r=n.lastChild),o===n.lastChild&&je(o.previousSibling)&&t.remove(o.previousSibling),(o=n.lastChild)&&je(o)&&e.hasChildNodes()&&t.remove(o),Ve(t,n,!0)&&t.$(n).empty(),Gt(t,e,n),r&&n.appendChild(r),n=de(se.fromDom(n),se.fromDom(e))?t.getParents(e,Me,n):[],t.remove(e),b(n,function(e){Ve(t,e)&&e!==t.getRoot()&&t.remove(e)}))},en=function(e,t,n,r){var o,i,u,a=e.dom;a.isEmpty(r)?(i=n,u=r,(o=e).dom.$(u).empty(),Jt(o.dom,i,u),o.selection.setCursorLocation(u,0)):(t=It(t),Jt(a,n,r),e.selection.setRng(Rt(t)))},tn=function(e,t){var n=e.dom,r=e.selection,o=r.getStart(),i=ot(e,o),u=n.getParent(r.getStart(),"LI",i);if(u){o=u.parentNode;if(o===e.getBody()&&Ve(n,o))return!0;var a=Je(r.getRng()),s=n.getParent(Yt(e,a,t,i),"LI",i);if(s&&s!==u)return e.undoManager.transact(function(){t?en(e,a,s,u):u.parentNode.firstChild===u?At(e):function(e,t,n,r){t=It(t);Jt(e.dom,n,r);t=Rt(t);e.selection.setRng(t)}(e,a,u,s)}),!0;if(!s&&!t&&0===a.startOffset&&0===a.endOffset)return e.undoManager.transact(function(){Et(e)}),!0}return!1},nn=function(e,t){var n=e.dom,r=e.selection.getStart(),o=ot(e,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var r=Je(e.selection.getRng()),u=n.getParent(Yt(e,r,t,o),"LI",o);if(u)return e.undoManager.transact(function(){!function(e,t,n){n=e.getParent(t.parentNode,e.isBlock,n);e.remove(t),n&&e.isEmpty(n)&&e.remove(n)}(n,i,o),Kt(n,u.parentNode),e.selection.select(u,!0),e.selection.collapse(t)}),!0}return!1},rn=function(e,t){return e.selection.isCollapsed()?tn(r=e,o=t)||nn(r,o):(o=(n=e).selection.getStart(),e=ot(n,o),!!(n.dom.getParent(o,"LI,DT,DD",e)||0<rt(n).length)&&(n.undoManager.transact(function(){n.execCommand("Delete"),zt(n.dom,n.getBody())}),!0));var n,r,o},on=function(e){e=D(V(e).split("")),e=C(e,function(e,t){e=e.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,t)*e});return N(e,function(e,t){return e+t},0)},un=function(e){if(--e<0)return"";var t=e%26,e=Math.floor(e/26);return un(e)+String.fromCharCode("A".charCodeAt(0)+t)},an=function(t){var e,n=tt(t);_e(n)&&t.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:(e={start:t.dom.getAttrib(n,"start","1"),listStyleType:v.some(t.dom.getStyle(n,"list-style-type"))},n=parseInt(e.start,10),e.listStyleType.is("upper-alpha")?un(n):e.listStyleType.is("lower-alpha")?un(n).toLowerCase():e.start)},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(e){!function(e){switch(/^[0-9]+$/.test(t=e)?2:/^[A-Z]+$/.test(t)?0:/^[a-z]+$/.test(t)?1:0<t.length?4:3){case 2:return v.some({listStyleType:v.none(),start:e});case 0:return v.some({listStyleType:v.some("upper-alpha"),start:on(e).toString()});case 1:return v.some({listStyleType:v.some("lower-alpha"),start:on(e).toString()});case 3:return v.some({listStyleType:v.none(),start:""});case 4:return v.none()}var t}(e.getData().start).each(function(e){t.execCommand("mceListUpdate",!1,{attrs:{start:"1"===e.start?"":e.start},styles:{"list-style-type":e.listStyleType.getOr("")}})}),e.close()}})},sn=function(t,n){return function(){var e=tt(t);return e&&e.nodeName===n}},cn=function(e){e.addCommand("mceListProps",function(){an(e)})},fn=function(i){i.on("BeforeExecCommand",function(e){e=e.command.toLowerCase();"indent"===e?xt(i):"outdent"===e&&At(i)}),i.addCommand("InsertUnorderedList",function(e,t){Qt(i,"UL",t)}),i.addCommand("InsertOrderedList",function(e,t){Qt(i,"OL",t)}),i.addCommand("InsertDefinitionList",function(e,t){Qt(i,"DL",t)}),i.addCommand("RemoveList",function(){Et(i)}),cn(i),i.addCommand("mceListUpdate",function(e,t){var n,r,o;u(t)&&(r=t,o=tt(n=i),n.undoManager.transact(function(){u(r.styles)&&n.dom.setStyles(o,r.styles),u(r.attrs)&&ve(r.attrs,function(e,t){return n.dom.setAttrib(o,t,e)})}))}),i.addQueryStateHandler("InsertUnorderedList",sn(i,"UL")),i.addQueryStateHandler("InsertOrderedList",sn(i,"OL")),i.addQueryStateHandler("InsertDefinitionList",sn(i,"DL"))},dn=function(e){var t,n;e.getParam("lists_indent_on_tab",!0)&&(t=e).on("keydown",function(e){e.keyCode!==ge.TAB||ge.metaKeyPressed(e)||t.undoManager.transact(function(){(e.shiftKey?At:xt)(t)&&e.preventDefault()})}),(n=e).on("keydown",function(e){e.keyCode===ge.BACKSPACE?rn(n,!1)&&e.preventDefault():e.keyCode===ge.DELETE&&rn(n,!0)&&e.preventDefault()})};e.add("lists",function(e){var t,n,r,o;return!1===e.hasPlugin("rtc",!0)?(dn(e),fn(e)):cn(e),r=function(e){return function(){return t.execCommand(e)}},(t=e).hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:r("InsertOrderedList"),onSetup:function(e){return _t(t,"OL",e.setActive)}}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:r("InsertUnorderedList"),onSetup:function(e){return _t(t,"UL",e.setActive)}})),r={text:"List properties...",icon:"ordered-list",onAction:function(){return n.execCommand("mceListProps")},onSetup:function(t){return _t(n,"OL",function(e){return t.setDisabled(!e)})}},(n=e).ui.registry.addMenuItem("listprops",r),n.ui.registry.addContextMenu("lists",{update:function(e){e=tt(n,e);return _e(e)?["listprops"]:[]}}),o=e,{backspaceDelete:function(e){rn(o,e)}}})}();