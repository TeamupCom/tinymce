/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
!function(){"use strict";var n,t,e=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=tinymce.util.Tools.resolve("tinymce.util.VK"),r=function(e){return function(t){return t=typeof(n=t),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===e;var n}},i=function(n){return function(t){return typeof t===n}},u=r("string"),a=r("array"),l=function(t){return n===t},c=i("boolean"),f=i("function"),s=function(t){t=t.getParam("link_assume_external_targets",!1);return c(t)&&t?1:!u(t)||"http"!==t&&"https"!==t?0:t},m=function(t){return t.getParam("default_link_target")},g=function(t){return t.getParam("target_list",!0)},d=function(t){return t.getParam("rel_list",[],"array")},h=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},p=function(){},v=function(t){return function(){return t}},y=v(!1),k=v(!(n=null)),x=function(){return b},b=(t=function(t){return t.isNone()},{fold:function(t,n){return t()},is:y,isSome:y,isNone:k,getOr:r=function(t){return t},getOrThunk:i=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:v(null),getOrUndefined:v(undefined),or:r,orThunk:i,map:x,each:p,bind:x,exists:y,forall:k,filter:x,equals:t,equals_:t,toArray:function(){return[]},toString:v("none()")}),O=function(e){var t=v(e),n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:k,isNone:y,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return O(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?o:b},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(y,function(t){return n(e,t)})}};return o},w={some:O,none:x,from:function(t){return null===t||t===undefined?b:O(t)}},C=Array.prototype.indexOf,N=Array.prototype.push,A=function(t,n){return-1<C.call(t,n)},P=function(t,n,e){return function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)}(t,function(t){e=n(e,t)}),e},T=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!a(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);N.apply(n,t[e])}return n},S=function(t,n){return T(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,n))},_=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return w.none()},R=function(t,n){return t?w.some(n):w.none()},D=tinymce.util.Tools.resolve("tinymce.util.Tools"),L=function(t){return u(t.value)?t.value:""},E=function(t,r){var o=[];return D.each(t,function(t){var n,e=u((n=t).text)?n.text:u(n.title)?n.title:"";t.menu!==undefined?(n=E(t.menu,r),o.push({text:e,items:n})):(t=r(t),o.push({text:e,value:t}))}),o},M=function(n){return void 0===n&&(n=L),function(t){return w.from(t).map(function(t){return E(t,n)})}},U={sanitize:function(t){return M(L)(t)},sanitizeWith:M,createUi:function(n,e){return function(t){return{name:n,type:"listbox",label:e,items:t}}},getValue:L},B=function(){return(B=Object.assign||function B(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},q=Object.keys,I=Object.hasOwnProperty,K=function(t,e,r,o){return function(t,n){for(var e=q(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}}(t,function(t,n){(e(t,n)?r:o)(t,n)}),{}},z=function(t,n){return I.call(t,n)},j=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),V=function(t){return t&&"a"===t.nodeName.toLowerCase()},F=function(t){return V(t)&&!!G(t)},W=function(t,n){if(t.collapsed)return[];for(var t=t.cloneContents(),e=new j(t.firstChild,t),r=[],o=t.firstChild;n(o)&&r.push(o),o=e.next(););return r},H=function(t){return/^\w+:/i.test(t)},G=function(t){var n=t.getAttribute("data-mce-href");return n||t.getAttribute("href")},J=function(t,n){var e,r=["noopener"],o=t?t.split(/\s+/):[],i=function(t){return t.filter(function(t){return-1===D.inArray(r,t)})},u=n?0<(e=i(e=o)).length?e.concat(r):r:i(o);return 0<u.length?D.trim(u.sort().join(" ")):""},X=function(t,n){return n=n||t.selection.getNode(),Z(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},$=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},Q=function(t){return 0<D.grep(t,F).length},Y=function(t){var n=t.schema.getTextInlineElements();return 0===W(t.selection.getRng(),function(t){return 1===t.nodeType&&!V(t)&&!z(n,t.nodeName.toLowerCase())}).length},Z=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},tt=function(t,n){var e,n=B({},n);return 0<d(t).length||!1!==h(t)||(e=J(n.rel,"_blank"===n.target),n.rel=e||null),w.from(n.target).isNone()&&!1===g(t)&&(n.target=m(t)),n.href=(e=n.href,"http"!==(t=s(t))&&"https"!==t||H(e)?e:t+"://"+e),n},nt=function(u,a,l){var t,c=u.selection.getNode(),f=X(u,c),s=tt(u,P(["title","rel","class","target"],function(n,e){return t[e].each(function(t){n[e]=0<t.length?t:null}),n},{href:(t=l).href}));u.undoManager.transact(function(){var n,e,t,r,o,i;l.href===a.href&&a.attach(),f?(u.focus(),t=u,r=f,o=l.text,i=s,o.each(function(t){r.hasOwnProperty("innerText")?r.innerText=t:r.textContent=t}),t.dom.setAttribs(r,i),t.selection.select(r)):(n=u,i=c,t=l.text,e=s,Z(i)?at(n,i,e):t.fold(function(){n.execCommand("mceInsertLink",!1,e)},function(t){n.insertContent(n.dom.createHTML("a",e,n.dom.encode(t)))}))})},et=function(u){u.undoManager.transact(function(){var t,n,e,r,o,i=u.selection.getNode();Z(i)?ut(u,i):(n=(t=u).dom,e=t.selection,r=e.getBookmark(),o=e.getRng().cloneRange(),i=n.getParent(o.startContainer,"a[href]",t.getBody()),n=n.getParent(o.endContainer,"a[href]",t.getBody()),i&&o.setStartBefore(i),n&&o.setEndAfter(n),e.setRng(o),t.execCommand("unlink"),e.moveToBookmark(r)),u.focus()})},rt=function(t){var e,n=t["class"],r=t.href,o=t.rel,i=t.target,u=t.text,t=t.title;return t={"class":n.getOrNull(),href:r,rel:o.getOrNull(),target:i.getOrNull(),text:u.getOrNull(),title:t.getOrNull()},K(t,function(t,n){return!1===l(t)},(e=t={},function(t,n){e[n]=t}),p),t},ot=function(t,n,e){t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,rt(e)):nt(t,n,e)},it=function(t){t.hasPlugin("rtc",!0)?t.execCommand("unlink"):et(t)},ut=function(t,n){var e=t.dom.select("img",n)[0];!e||(n=t.dom.getParents(e,"a[href]",n)[0])&&(n.parentNode.insertBefore(e,n),t.dom.remove(n))},at=function(t,n,e){n=t.dom.select("img",n)[0];n&&(e=t.dom.create("a",e),n.parentNode.insertBefore(e,n),e.appendChild(n))},lt=function(t){return z(n=t,t="items")&&n[t]!==undefined&&null!==n[t];var n},ct=function(n,t){return _(t,function(t){return lt(t)?ct(n,t.items):R(t.value===n,t)})},ft=function(n,t,e,r){var t=r[t],o=0<n.length;return t!==undefined?ct(t,e).map(function(t){return{url:{value:t.value,meta:{text:o?n:t.text,attach:p}},text:o?n:t.text}}):w.none()},st=function(t,o){var i={text:t.text,title:t.title},r=function(t){var n,n=(n=t.url,R(i.text.length<=0,w.from(n.meta.text).getOr(n.value))),t=(t=t.url,R(i.title.length<=0,w.from(t.meta.title).getOr("")));return n.isSome()||t.isSome()?w.some(B(B({},n.map(function(t){return{text:t}}).getOr({})),t.map(function(t){return{title:t}}).getOr({}))):w.none()},u=function(t,n){var e,r,e=(e=o,("link"===(r=n.name)?e.link:"anchor"===r?e.anchor:w.none()).getOr([]));return ft(i.text,n.name,e,t)};return{onChange:function(t,n){var e=n.name;return"url"===e?r(t()):A(["anchor","link"],e)?u(t(),n):(("text"===e||"title"===e)&&(i[e]=t()[e]),w.none())}}},mt=tinymce.util.Tools.resolve("tinymce.util.Delay"),gt=tinymce.util.Tools.resolve("tinymce.util.Promise"),dt=function(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?w.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return B(B({},t),{href:"mailto:"+n})}}):w.none()},ht=function(u,a){return _([dt,(e=s(u),r=u.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!H(n)||0===e&&/^\s*www(\.|\d\.)/i.test(n)?w.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return B(B({},t),{href:r+"://"+n})}}):w.none()})],function(t){return t(a)}).fold(function(){return gt.resolve(a)},function(i){return new gt(function(n){var e,t,r,o;e=u,t=i.message,r=function(t){n(t?i.preprocess(a):a)},o=e.selection.getRng(),mt.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),r(t)})})})});var e,r},pt=function(t){t=t.dom.select("a:not([href])"),t=S(t,function(t){t=t.name||t.id;return t?[{text:t,value:"#"+t}]:[]});return 0<t.length?w.some([{text:"None",value:""}].concat(t)):w.none()},vt=function(t){t=t.getParam("link_class_list",[],"array");return 0<t.length?U.sanitize(t):w.none()},yt=tinymce.util.Tools.resolve("tinymce.util.XHR"),kt=function(n){var e=function(t){return n.convertURL(t.value||t.url,"href")},t=n.getParam("link_list");return new gt(function(n){u(t)?yt.send({url:t,success:function(t){return n(function(t){try{return w.some(JSON.parse(t))}catch(n){return w.none()}}(t))},error:function(t){return n(w.none())}}):f(t)?t(function(t){return n(w.some(t))}):n(w.from(t))}).then(function(t){return t.bind(U.sanitizeWith(e)).map(function(t){if(0<t.length)return[{text:"None",value:""}].concat(t);return t})})},xt=function(t,n){var e=d(t);if(0<e.length){var r=n.is("_blank");return(!1===h(t)?U.sanitizeWith(function(t){return J(U.getValue(t),r)}):U.sanitize)(e)}return w.none()},bt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Ot=function(t){t=g(t);return a(t)?U.sanitize(t).orThunk(function(){return w.some(bt)}):!1===t?w.none():w.some(bt)},wt=function(t,n,e){e=t.getAttrib(n,e);return null!==e&&0<e.length?w.some(e):w.none()},Ct=function(l,c){return kt(l).then(function(t){var n,e,r,o,i,u,a,n=(e=c,r=(n=l).dom,o=Y(n)?w.some($(n.selection,e)):w.none(),i=e?w.some(r.getAttrib(e,"href")):w.none(),u=e?w.from(r.getAttrib(e,"target")):w.none(),a=wt(r,e,"rel"),n=wt(r,e,"class"),{url:i,text:o,title:wt(r,e,"title"),target:u,rel:a,linkClass:n});return{anchor:n,catalogs:{targets:Ot(l),rels:xt(l,n.target),classes:vt(l),anchor:pt(l),link:t},optNode:w.from(c),flags:{titleEnabled:l.getParam("link_title",!0,"boolean")}}})},Nt=function(f){var t,n;(n=X(t=f),Ct(t,n)).then(function(t){var o,i,n,e,r,u,a,l,c;return e=function(t){var e=t.getData();if(!e.url.value)return it(o),void t.close();var n=function(n){return w.from(e[n]).filter(function(t){return!i.anchor[n].is(t)})},n={href:e.url.value,text:n("text"),target:n("target"),rel:n("rel"),"class":n("linkClass"),title:n("title")},r={href:e.url.value,attach:e.url.meta!==undefined&&e.url.meta.attach?e.url.meta.attach:p};ht(o,n).then(function(t){ot(o,r,t)}),t.close()},r=o=f,u=(n=i=t).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),a=n.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],l=w.from(m(r)),t=l,l={url:{value:r=(l=(r=n).anchor).url.getOr(""),meta:{original:{value:r}}},text:l.text.getOr(""),title:l.title.getOr(""),anchor:r,link:r,rel:l.rel.getOr(""),target:l.target.or(t).getOr(""),linkClass:l.linkClass.getOr("")},n=n.catalogs,c=st(l,n),{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:T([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],u,a,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([n.anchor.map(U.createUi("anchor","Anchors")),n.rels.map(U.createUi("rel","Rel")),n.targets.map(U.createUi("target","Open link in...")),n.link.map(U.createUi("link","Link list")),n.classes.map(U.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:l,onChange:function(n,t){t=t.name;c.onChange(n.getData,{name:t}).each(function(t){n.setData(t)})},onSubmit:e}}).then(function(t){f.windowManager.open(t)})},At=function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n=n,t=t,document.body.appendChild(n),n.dispatchEvent(t),document.body.removeChild(n)},Pt=function(t,n){return t.dom.getParent(n,"a[href]")},Tt=function(t){return Pt(t,t.selection.getStart())},St=function(t,n){var e;n&&(e=G(n),/^#/.test(e)?(e=t.$(e)).length&&t.selection.scrollIntoView(e[0],!0):At(n.href))},_t=function(t){return function(){Nt(t)}},Rt=function(t){return function(){St(t,Tt(t))}},Dt=function(r){r.on("click",function(t){var n=Pt(r,t.target);n&&o.metaKeyPressed(t)&&(t.preventDefault(),St(r,n))}),r.on("keydown",function(t){var n,e=Tt(r);e&&13===t.keyCode&&(!0===(n=t).altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey)&&(t.preventDefault(),St(r,e))})},Lt=function(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}},Et=function(n){return function(t){return Lt(n,function(){t.setActive(!n.mode.isReadOnly()&&null!==X(n,n.selection.getNode()))})}},Mt=function(e){return function(t){var n=function(){return t.setDisabled(null===X(e,e.selection.getNode()))};return n(),Lt(e,n)}},Ut=function(r){return function(n){var e=function(t){return Q(t)||(t=r.selection.getRng(),0<W(t,F).length)},t=r.dom.getParents(r.selection.getStart());return n.setDisabled(!e(t)),Lt(r,function(t){return n.setDisabled(!e(t.parents))})}};e.add("link",function(t){var n,e,r,i,o,u,a;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:_t(n),onSetup:Et(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:Rt(n),onSetup:Mt(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return it(n)},onSetup:Ut(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:Rt(e),onSetup:Mt(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:_t(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return it(e)},onSetup:Ut(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return Q(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),o=function(t){var n=i.selection.getNode();return t.setDisabled(!X(i,n)),p},(i=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:Et(i)},label:"Link",predicate:function(t){return!!X(i,t)&&i.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=X(i);return t?G(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=i.selection.getNode();return t.setActive(!!X(i,n)),Et(i)(t)},onAction:function(t){var n,e,r=X(i),o=t.getValue();r?i.undoManager.transact(function(){i.dom.setAttrib(r,"href",o),i.selection.collapse(!1),t.hide()}):(n={href:o,attach:p},e=Y(i)?w.some($(i.selection,r)).filter(function(t){return 0<t.length}).or(w.from(o)):w.none(),ot(i,n,{href:o,text:e,title:w.none(),rel:w.none(),target:w.none(),"class":w.none()}),t.hide())}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:o,onAction:function(t){it(i),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:o,onAction:function(t){Rt(i)(),t.hide()}}]}),Dt(t),(u=t).addCommand("mceLink",function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):_t(u)()}),(a=t).addShortcut("Meta+K","",function(){a.execCommand("mceLink")})})}();